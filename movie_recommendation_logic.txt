import pandas as pd
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.metrics.pairwise import linear_kernel
import logging

# Configure logging
logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')

def load_movie_data(file_path):
    """
    Loads movie data from a CSV file.
    
    :param file_path: Path to the CSV file containing movie data.
    :return: DataFrame with movie data.
    """
    try:
        movies_df = pd.read_csv(file_path)
        logging.info("Movie data loaded successfully.")
        return movies_df
    except FileNotFoundError as e:
        logging.error(f"File not found: {e}")
        raise
    except pd.errors.ParserError as e:
        logging.error(f"Error parsing CSV file: {e}")
        raise

def compute_similarity_matrix(movies_df):
    """
    Computes the cosine similarity matrix for movies based on their descriptions.
    
    :param movies_df: DataFrame containing movie data.
    :return: Cosine similarity matrix.
    """
    tfidf_vectorizer = TfidfVectorizer(stop_words='english')
    
    # Replace NaN with empty string for the description field
    movies_df['description'] = movies_df['description'].fillna('')
    
    # Compute the TF-IDF matrix
    tfidf_matrix = tfidf_vectorizer.fit_transform(movies_df['description'])
    
    # Compute the cosine similarity matrix
    cosine_similarity_matrix = linear_kernel(tfidf_matrix, tfidf_matrix)
    logging.info("Cosine similarity matrix computed.")
    return cosine_similarity_matrix

def get_recommendations(movie_title, movies_df, cosine_similarity_matrix):
    """
    Recommends movies similar to the given movie title.
    
    :param movie_title: Title of the movie to find recommendations for.
    :param movies_df: DataFrame containing movie data.
    :param cosine_similarity_matrix: Precomputed cosine similarity matrix.
    :return: List of recommended movie titles.
    """
    try:
        # Get index of the movie that matches the title
        idx = movies_df[movies_df['title'] == movie_title].index[0]
        
        # Get the pairwise similarity scores of all movies with that movie
        similarity_scores = list(enumerate(cosine_similarity_matrix[idx]))
        
        # Sort the movies based on the similarity scores
        similarity_scores = sorted(similarity_scores, key=lambda x: x[1], reverse=True)
        
        # Get the scores of the 10 most similar movies
        similarity_scores = similarity_scores[1:11]
        
        # Get the movie indices
        movie_indices = [i[0] for i in similarity_scores]
        
        # Return the top 10 most similar movies
        recommended_titles = movies_df['title'].iloc[movie_indices].tolist()
        logging.info(f"Recommendations for '{movie_title}' generated.")
        return recommended_titles
    except IndexError as e:
        logging.error(f"Movie '{movie_title}' not found in the database: {e}")
        return []
    except Exception as e:
        logging.error(f"An error occurred while generating recommendations: {e}")
        return []

def main():
    # File path to the movie dataset
    movie_data_file = 'movies.csv'
    
    # Load movie data
    movies_df = load_movie_data(movie_data_file)
    
    # Compute the similarity matrix
    cosine_similarity_matrix = compute_similarity_matrix(movies_df)
    
    # Sample movie for recommendations
    sample_movie_title = 'The Matrix'
    
    # Get recommendations
    recommendations = get_recommendations(sample_movie_title, movies_df, cosine_similarity_matrix)
    
    # Display recommendations
    if recommendations:
        print(f"Movies recommended for '{sample_movie_title}':")
        for title in recommendations:
            print(f"- {title}")
    else:
        print(f"No recommendations found for '{sample_movie_title}'.")

if __name__ == '__main__':
    main()